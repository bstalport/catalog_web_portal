<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Portal Dashboard/Onboarding Template -->
    <template id="portal_catalog_dashboard" name="Catalog Portal Dashboard">
        <t t-call="catalog_web_portal.portal_catalog_layout">
            <t t-set="page_type">dashboard</t>

            <!-- Welcome Header -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card border-0 bg-primary text-white">
                        <div class="card-body">
                            <h2 class="mb-3">
                                <i class="fa fa-rocket"/> Welcome to Your Product Catalog
                            </h2>
                            <p class="lead mb-0">
                                Import products from your supplier directly into your Odoo with just a few clicks.
                                Follow the steps below to get started.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Steps -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">
                                <i class="fa fa-tasks"/> Your Progress
                            </h5>

                            <!-- Step 1: Browse Products -->
                            <div class="setup-step">
                                <div class="d-flex align-items-start mb-4">
                                    <div class="step-number bg-primary text-white">1</div>
                                    <div class="flex-grow-1 ml-3">
                                        <h6 class="mb-2">
                                            <i class="fa fa-shopping-basket"/> Browse &amp; Select Products
                                        </h6>
                                        <p class="text-muted mb-2">
                                            Browse the supplier's catalog and add products to your selection.
                                        </p>

                                        <!-- Action Buttons -->
                                        <div class="mb-3">
                                            <a href="/catalog/portal/browse" class="btn btn-primary">
                                                <i class="fa fa-book"/> Browse Catalog
                                            </a>
                                            <t t-if="selected_count > 0">
                                                <a href="/catalog/portal/cart" class="btn btn-outline-primary ml-2">
                                                    <i class="fa fa-eye"/> View Selection
                                                </a>
                                                <button id="btn-clear-selection-dashboard" class="btn btn-outline-danger ml-2">
                                                    <i class="fa fa-trash"/> Clear Selection
                                                </button>
                                            </t>
                                        </div>

                                        <!-- Selection Status -->
                                        <t t-if="selected_count > 0">
                                            <div class="alert alert-success mb-2">
                                                <i class="fa fa-check-circle"/> <strong><t t-out="selected_count"/> product(s)</strong> selected
                                            </div>
                                        </t>

                                        <!-- Saved Selections in Step 1 -->
                                        <t t-if="saved_selections">
                                            <div class="mt-3">
                                                <h6 class="mb-2 small text-muted">
                                                    <i class="fa fa-bookmark text-info"/> Or load a saved selection:
                                                </h6>
                                                <div class="list-group list-group-flush">
                                                    <t t-foreach="saved_selections" t-as="selection">
                                                        <div class="list-group-item d-flex justify-content-between align-items-center px-2 py-2">
                                                            <div class="flex-grow-1">
                                                                <strong class="text-info"><t t-out="selection.name"/></strong>
                                                                <small class="text-muted ml-2">
                                                                    (<t t-out="selection.product_count"/> products)
                                                                </small>
                                                            </div>
                                                            <div class="btn-group btn-group-sm">
                                                                <button class="btn btn-success btn-load-saved-selection"
                                                                        t-att-data-selection-id="selection.id"
                                                                        t-att-data-selection-name="selection.name">
                                                                    <i class="fa fa-upload"/> Load
                                                                </button>
                                                                <button class="btn btn-outline-danger btn-delete-saved-selection"
                                                                        t-att-data-selection-id="selection.id"
                                                                        t-att-data-selection-name="selection.name">
                                                                    <i class="fa fa-trash"/>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>

                            <hr/>

                            <!-- Step 2: Export or Import -->
                            <div class="setup-step">
                                <div class="d-flex align-items-start">
                                    <div t-attf-class="step-number {{ 'bg-primary text-white' if selected_count > 0 else 'bg-secondary text-white' }}">2</div>
                                    <div class="flex-grow-1 ml-3">
                                        <h6 class="mb-2">
                                            <i class="fa fa-download"/> Get Your Products
                                        </h6>
                                        <p class="text-muted mb-2">
                                            Choose your preferred method to get the selected products into your Odoo.
                                        </p>

                                        <t t-if="selected_count == 0">
                                            <div class="alert alert-secondary mb-0">
                                                <i class="fa fa-arrow-up"/> First, select some products from the catalog
                                            </div>
                                        </t>
                                        <t t-else="">
                                            <div class="row mt-3">
                                                <!-- CSV Export Option -->
                                                <div class="col-md-6 mb-3">
                                                    <div class="card h-100 border-primary">
                                                        <div class="card-body">
                                                            <h6 class="card-title">
                                                                <i class="fa fa-file-excel-o text-success"/> CSV Export
                                                            </h6>
                                                            <p class="small text-muted">
                                                                Download a CSV file and import manually into your Odoo.
                                                            </p>
                                                            <ul class="small mb-3">
                                                                <li>No configuration needed</li>
                                                                <li>Works with any Odoo (including Odoo Online)</li>
                                                                <li>Full control over import</li>
                                                            </ul>
                                                            <form method="post" action="/catalog/export/csv">
                                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                                <div class="custom-control custom-switch mb-2">
                                                                    <input type="checkbox" class="custom-control-input"
                                                                           id="csv_include_images" name="include_images" value="1"/>
                                                                    <label class="custom-control-label small" for="csv_include_images">
                                                                        Include images
                                                                    </label>
                                                                </div>
                                                                <button type="submit" class="btn btn-success btn-block">
                                                                    <i class="fa fa-download"/> Download CSV
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Direct Import Option -->
                                                <div class="col-md-6 mb-3">
                                                    <div class="card h-100 border-info">
                                                        <div class="card-body">
                                                            <h6 class="card-title">
                                                                <i class="fa fa-magic text-info"/> Direct Import
                                                            </h6>
                                                            <p class="small text-muted mb-3">
                                                                Import directly into your Odoo with one click.
                                                            </p>

                                                            <!-- Step A: Connection -->
                                                            <div class="d-flex align-items-center mb-2">
                                                                <t t-if="connection_configured and connection.connection_status == 'ok'">
                                                                    <span class="badge bg-success mr-2"><i class="fa fa-check"/></span>
                                                                    <span class="small flex-grow-1">
                                                                        Connected to <strong><t t-out="connection.odoo_url"/></strong>
                                                                    </span>
                                                                    <a href="/catalog/portal/sync/setup" class="btn btn-outline-secondary btn-sm">
                                                                        <i class="fa fa-cog"/>
                                                                    </a>
                                                                </t>
                                                                <t t-elif="connection_configured">
                                                                    <span class="badge bg-warning text-dark mr-2"><i class="fa fa-exclamation"/></span>
                                                                    <span class="small flex-grow-1 text-muted">Connection not tested</span>
                                                                    <a href="/catalog/portal/sync/setup" class="btn btn-warning btn-sm">
                                                                        <i class="fa fa-plug"/> Test
                                                                    </a>
                                                                </t>
                                                                <t t-else="">
                                                                    <span class="badge bg-secondary mr-2"><i class="fa fa-circle-o"/></span>
                                                                    <span class="small flex-grow-1 text-muted">Connect your Odoo</span>
                                                                    <a href="/catalog/portal/sync/setup" class="btn btn-info btn-sm">
                                                                        <i class="fa fa-plug"/> Setup
                                                                    </a>
                                                                </t>
                                                            </div>

                                                            <!-- Step B: Field Mappings -->
                                                            <div class="d-flex align-items-center mb-3">
                                                                <t t-if="connection_configured and connection.connection_status == 'ok'">
                                                                    <span class="badge bg-success mr-2"><i class="fa fa-check"/></span>
                                                                    <span class="small flex-grow-1">Field mappings configured</span>
                                                                    <a href="/catalog/portal/sync/mappings" class="btn btn-outline-secondary btn-sm">
                                                                        <i class="fa fa-exchange"/>
                                                                    </a>
                                                                </t>
                                                                <t t-else="">
                                                                    <span class="badge bg-secondary mr-2"><i class="fa fa-circle-o"/></span>
                                                                    <span class="small flex-grow-1 text-muted">Configure field mappings</span>
                                                                    <a href="/catalog/portal/sync/mappings" class="btn btn-outline-secondary btn-sm disabled">
                                                                        <i class="fa fa-exchange"/>
                                                                    </a>
                                                                </t>
                                                            </div>

                                                            <!-- Import Button -->
                                                            <t t-if="connection_configured and connection.connection_status == 'ok'">
                                                                <a href="/catalog/portal/sync/preview" class="btn btn-info btn-block">
                                                                    <i class="fa fa-cloud-upload"/> Import to My Odoo
                                                                </a>
                                                            </t>
                                                            <t t-else="">
                                                                <button class="btn btn-secondary btn-block" disabled="disabled">
                                                                    <i class="fa fa-cloud-upload"/> Import to My Odoo
                                                                </button>
                                                                <p class="small text-muted text-center mt-2 mb-0">
                                                                    Complete the steps above to enable import
                                                                </p>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h2 class="mb-0 text-primary"><t t-out="total_products"/></h2>
                            <p class="text-muted mb-0">Products Available</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h2 class="mb-0 text-success"><t t-out="selected_count"/></h2>
                            <p class="text-muted mb-0">Products Selected</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h2 class="mb-0 text-info"><t t-out="saved_selections_count"/></h2>
                            <p class="text-muted mb-0">Saved Selections</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help Section -->
            <div class="row">
                <div class="col-md-12">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fa fa-question-circle"/> Need Help?
                            </h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="small mb-2"><strong>How to browse products:</strong></p>
                                    <p class="small text-muted">
                                        Use the search bar and filters to find products. Click on a product to see details,
                                        or use the "Add to Selection" button to add it to your cart.
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p class="small mb-2"><strong>CSV vs Direct Import:</strong></p>
                                    <p class="small text-muted">
                                        CSV export works immediately and gives you full control. Direct import is faster
                                        but requires a one-time connection setup with your Odoo.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </t>
    </template>

</odoo>
